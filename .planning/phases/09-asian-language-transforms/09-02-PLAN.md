---
phase: 09-asian-language-transforms
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - crates/rlf/src/interpreter/transforms.rs
  - crates/rlf/tests/interpreter_transforms.rs
autonomous: true

must_haves:
  truths:
    - "Vietnamese @count produces number + classifier + noun (e.g., '3 cai ban')"
    - "Thai @count produces number + classifier + noun (e.g., '3ใบการ์ด')"
    - "Bengali @count produces number + classifier + noun (e.g., '3টা বই')"
    - "Indonesian @plural produces reduplication (e.g., 'kartu-kartu')"
  artifacts:
    - path: "crates/rlf/src/interpreter/transforms.rs"
      provides: "VietnameseCount, ThaiCount, BengaliCount, IndonesianPlural transforms"
      contains: "VietnameseCount"
  key_links:
    - from: "crates/rlf/src/interpreter/transforms.rs"
      to: "TransformRegistry::get"
      via: "language-specific transform registration"
      pattern: "vi.*count|th.*count|bn.*count|id.*plural"
---

<objective>
Implement @count transforms for Vietnamese, Thai, Bengali and @plural for Indonesian.

Purpose: Complete the classifier/counter transform coverage for Southeast Asian languages, plus Indonesian reduplication plural.
Output: Four working transforms with comprehensive tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-asian-language-transforms/09-RESEARCH.md
@.planning/phases/09-asian-language-transforms/09-01-SUMMARY.md
@crates/rlf/src/interpreter/transforms.rs
@docs/APPENDIX_STDLIB.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TransformKind variants and classifier constants</name>
  <files>crates/rlf/src/interpreter/transforms.rs</files>
  <action>
Add four new TransformKind variants:
- VietnameseCount - @count for vi
- ThaiCount - @count for th
- BengaliCount - @count for bn
- IndonesianPlural - @plural for id

Add classifier constant arrays based on APPENDIX_STDLIB.md:

Vietnamese classifiers (VIETNAMESE_CLASSIFIERS):
- cai -> "cai" (general objects) - note: Vietnamese uses Latin script
- con -> "con" (animals, some objects)
- nguoi -> "nguoi" (people) - actually should be "người" but keeping ASCII tag
- chiec -> "chiec" (vehicles, single items) - maps to "chiếc"
- to -> "to" (flat paper items) - maps to "tờ"

Thai classifiers (THAI_CLASSIFIERS):
- bai -> ใบ (flat objects, cards)
- tua -> ตัว (animals, letters, characters)
- khon -> คน (people)
- an -> อัน (general small objects)

Bengali classifiers (BENGALI_CLASSIFIERS):
- ta -> টা (general classifier)
- ti -> টি (formal classifier)
- khana -> খানা (for flat objects)
- jon -> জন (for people)
  </action>
  <verify>Run `just check` to verify code compiles</verify>
  <done>TransformKind variants defined, classifier arrays defined</done>
</task>

<task type="auto">
  <name>Task 2: Implement SEA @count and Indonesian @plural transforms</name>
  <files>crates/rlf/src/interpreter/transforms.rs</files>
  <action>
Implement vietnamese_count_transform:
- Read classifier tag from VIETNAMESE_CLASSIFIERS
- Get count from context via context_to_count() (from Plan 01)
- Output: "{count} {classifier} {text}" - Vietnamese uses spaces between elements
- Return MissingTag error if no classifier tag found

Implement thai_count_transform:
- Read classifier tag from THAI_CLASSIFIERS
- Get count from context
- Output: "{count}{classifier}{text}" - Thai typically no spaces
- Return MissingTag error if no classifier tag found

Implement bengali_count_transform:
- Read classifier tag from BENGALI_CLASSIFIERS
- Get count from context
- Per RESEARCH.md: classifier attaches to number, space before noun
- Output: "{count}{classifier} {text}" - classifier immediately after number, then space, then noun
- Return MissingTag error if no classifier tag found

Implement indonesian_plural_transform:
- Simple reduplication: text -> "{text}-{text}"
- No tags required, no context needed
- Example: "kartu" -> "kartu-kartu"

Wire all four transforms in TransformKind::execute() match arm.

Register in TransformRegistry::get():
- ("vi", "count") => Some(TransformKind::VietnameseCount)
- ("th", "count") => Some(TransformKind::ThaiCount)
- ("bn", "count") => Some(TransformKind::BengaliCount)
- ("id", "plural") => Some(TransformKind::IndonesianPlural)
  </action>
  <verify>Run `just check` to verify code compiles</verify>
  <done>Four transforms implemented and registered</done>
</task>

<task type="auto">
  <name>Task 3: Add comprehensive tests for SEA transforms</name>
  <files>crates/rlf/tests/interpreter_transforms.rs</files>
  <action>
Add test module for Southeast Asian transforms with tests:

Vietnamese @count tests:
- test_vietnamese_count_cai: :cai "ban" (table) with context 3 -> "3 cai ban"
- test_vietnamese_count_con: :con "meo" (cat) with context 2 -> "2 con meo"
- test_vietnamese_count_missing_tag: phrase without classifier tag returns MissingTag error

Thai @count tests:
- test_thai_count_bai: :bai "การ์ด" (card) with context 3 -> "3ใบการ์ด"
- test_thai_count_khon: :khon "คน" (person) with context 2 -> "2คนคน" (hmm) - actually noun should be different, use "ผู้เล่น" (player)
- test_thai_count_missing_tag: phrase without classifier tag returns MissingTag error

Bengali @count tests:
- test_bengali_count_ta: :ta "বই" (book) with context 3 -> "3টা বই"
- test_bengali_count_jon: :jon "খেলোয়াড়" (player) with context 2 -> "2জন খেলোয়াড়"
- test_bengali_count_missing_tag: phrase without classifier tag returns MissingTag error

Indonesian @plural tests:
- test_indonesian_plural_basic: "kartu" -> "kartu-kartu"
- test_indonesian_plural_buku: "buku" (book) -> "buku-buku"
- test_indonesian_plural_empty: "" -> "-" (edge case)

Use the established test pattern from Plan 01 tests.
  </action>
  <verify>Run `just review` to verify all tests pass and code quality checks pass</verify>
  <done>All SEA transform tests passing, just review clean</done>
</task>

</tasks>

<verification>
1. `just check` passes (code compiles)
2. `just test` passes (all existing + new tests)
3. `just review` passes (formatting, clippy, tests)
4. Vietnamese @count produces "3 cai ban" for :cai "ban" with count=3
5. Thai @count produces "3ใบการ์ด" for :bai "การ์ด" with count=3
6. Bengali @count produces "3টা বই" for :ta "বই" with count=3
7. Indonesian @plural produces "kartu-kartu" for "kartu"
8. All @count transforms return MissingTag error when classifier tag missing
</verification>

<success_criteria>
- Four transforms implemented and registered (Vietnamese, Thai, Bengali @count; Indonesian @plural)
- All tests pass including new SEA transform tests
- just review passes clean
</success_criteria>

<output>
After completion, create `.planning/phases/09-asian-language-transforms/09-02-SUMMARY.md`
</output>
