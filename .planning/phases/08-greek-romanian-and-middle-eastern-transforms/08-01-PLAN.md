---
phase: 08-greek-romanian-and-middle-eastern-transforms
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/rlf/src/interpreter/transforms.rs
  - crates/rlf/tests/interpreter_transforms.rs
autonomous: true

must_haves:
  truths:
    - "Greek @o transform outputs correct definite article for gender and case"
    - "Greek @enas transform outputs correct indefinite article for gender and case"
    - "Greek @i/@to aliases resolve to @o"
    - "Greek @mia/@ena aliases resolve to @enas"
    - "Romanian @def transform appends article suffix to word"
    - "Romanian neuter plural behaves as feminine"
  artifacts:
    - path: "crates/rlf/src/interpreter/transforms.rs"
      provides: "GreekO, GreekEnas, RomanianDef TransformKind variants"
      contains: "GreekO"
    - path: "crates/rlf/tests/interpreter_transforms.rs"
      provides: "Greek and Romanian transform tests"
      contains: "greek_o"
  key_links:
    - from: "TransformRegistry::get"
      to: "TransformKind::GreekO"
      via: "match (\"el\", \"o\")"
      pattern: "\"el\".*\"o\".*GreekO"
    - from: "TransformRegistry::get"
      to: "TransformKind::RomanianDef"
      via: "match (\"ro\", \"def\")"
      pattern: "\"ro\".*\"def\".*RomanianDef"
---

<objective>
Implement Greek article transforms (@o/@enas with aliases) and Romanian postposed article transform (@def).

Purpose: Greek has three-gender four-case declension like German. Romanian uniquely appends article suffixes rather than prepending.
Output: TransformKind variants for Greek definite/indefinite articles and Romanian postposed article, with comprehensive tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-greek-romanian-and-middle-eastern-transforms/08-CONTEXT.md
@.planning/phases/08-greek-romanian-and-middle-eastern-transforms/08-RESEARCH.md
@crates/rlf/src/interpreter/transforms.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Greek article transforms</name>
  <files>crates/rlf/src/interpreter/transforms.rs</files>
  <action>
Add Greek transform infrastructure following German pattern:

1. Add TransformKind variants:
   - GreekO (definite article @o with @i/@to aliases)
   - GreekEnas (indefinite article @enas with @mia/@ena aliases)

2. Create GreekGender enum (Masculine, Feminine, Neuter) - same as German

3. Reuse GermanCase for case parsing (nom/acc/gen/dat context) - identical pattern

4. Create declension tables from RESEARCH.md:

   greek_definite_article_singular(gender, case):
   - Masc: nom=o, acc=ton, gen=tou, dat=to
   - Fem: nom=i, acc=tin, gen=tis, dat=ti
   - Neut: nom=to, acc=to, gen=tou, dat=to

   greek_definite_article_plural(gender, case):
   - Masc: nom=oi, acc=tous, gen=ton, dat=tois
   - Fem: nom=oi, acc=tis, gen=ton, dat=tais
   - Neut: nom=ta, acc=ta, gen=ton, dat=tois

   greek_indefinite_article(gender, case) - singular only:
   - Masc: nom=enas, acc=enan, gen=enos, dat=eni
   - Fem: nom=mia, acc=mia, gen=mias, dat=mia
   - Neut: nom=ena, acc=ena, gen=enos, dat=eni

   Use actual Greek characters from RESEARCH.md tables (o/i/to/ton/etc. in Greek script).

5. Implement greek_o_transform(value, context):
   - Parse gender from :masc/:fem/:neut tags (reuse parse_german_gender or create similar)
   - Parse case from context (reuse parse_german_case)
   - Parse plural from context (reuse parse_romance_plural)
   - Select article from declension table
   - Format: "{article} {text}"

6. Implement greek_enas_transform(value, context):
   - Same pattern but indefinite articles (singular only)
   - Format: "{article} {text}"

7. Add to TransformKind::execute match arm dispatching to new functions

8. Add to TransformRegistry::get:
   - Aliases: ("i", "el") => "o", ("to", "el") => "o", ("mia", "el") => "enas", ("ena", "el") => "enas"
   - Matches: ("el", "o") => GreekO, ("el", "enas") => GreekEnas
  </action>
  <verify>cargo check --package rlf</verify>
  <done>GreekO and GreekEnas transforms compile, registry resolves @o/@i/@to/@enas/@mia/@ena for Greek</done>
</task>

<task type="auto">
  <name>Task 2: Romanian postposed article transform</name>
  <files>crates/rlf/src/interpreter/transforms.rs</files>
  <action>
Add Romanian postposed article transform:

1. Add TransformKind::RomanianDef variant

2. Create RomanianGender enum (Masculine, Feminine, Neuter) OR reuse three-gender pattern

3. Implement romanian_definite_suffix(gender, plural):
   Per CONTEXT.md: neuter singular -> masculine suffix, neuter plural -> feminine suffix

   Nominative/Accusative suffixes (most common):
   - Masc singular: -ul (e.g., baiat -> baiatul)
   - Masc plural: -ii
   - Fem singular: -a (e.g., carte -> cartea)
   - Fem plural: -le
   - Neut singular: -ul (like masc)
   - Neut plural: -le (like fem)

4. Implement romanian_def_transform(value, context):
   - Parse gender from :masc/:fem/:neut tags
   - Parse plural from context (reuse parse_romance_plural)
   - Get suffix from lookup table
   - IMPORTANT: APPEND suffix, not prepend: format!("{}{}", text, suffix)
   - Per RESEARCH.md: suffix may need vowel handling, but for MVP use simple append

5. Add to TransformKind::execute match arm

6. Add to TransformRegistry::get:
   - Match: ("ro", "def") => RomanianDef
  </action>
  <verify>cargo check --package rlf</verify>
  <done>RomanianDef transform compiles, registry resolves @def for Romanian</done>
</task>

<task type="auto">
  <name>Task 3: Greek and Romanian integration tests</name>
  <files>crates/rlf/tests/interpreter_transforms.rs</files>
  <action>
Add comprehensive tests for Greek and Romanian transforms:

Greek definite article tests (test each with Greek script output):
- greek_o_masculine_nominative: :masc tag, nom context -> "o {word}"
- greek_o_masculine_accusative: :masc tag, acc context -> "ton {word}"
- greek_o_masculine_genitive: :masc tag, gen context -> "tou {word}"
- greek_o_feminine_nominative: :fem tag, nom context -> "i {word}"
- greek_o_feminine_accusative: :fem tag, acc context -> "tin {word}"
- greek_o_neuter_nominative: :neut tag, nom context -> "to {word}"
- greek_o_plural_masculine: :masc tag, other context -> "oi {word}"
- greek_o_plural_feminine: :fem tag, other context -> "oi {word}"
- greek_o_plural_neuter: :neut tag, other context -> "ta {word}"
- greek_o_alias_i: @i resolves to @o for fem
- greek_o_alias_to: @to resolves to @o for neut

Greek indefinite article tests:
- greek_enas_masculine_nominative: :masc tag -> "enas {word}"
- greek_enas_feminine_nominative: :fem tag -> "mia {word}"
- greek_enas_neuter_nominative: :neut tag -> "ena {word}"
- greek_enas_alias_mia: @mia resolves to @enas
- greek_enas_alias_ena: @ena resolves to @enas

Romanian postposed article tests:
- romanian_def_masculine_singular: :masc tag -> "{word}ul"
- romanian_def_masculine_plural: :masc tag, other context -> "{word}ii"
- romanian_def_feminine_singular: :fem tag -> "{word}a"
- romanian_def_feminine_plural: :fem tag, other context -> "{word}le"
- romanian_def_neuter_singular: :neut tag -> "{word}ul" (like masc)
- romanian_def_neuter_plural: :neut tag, other context -> "{word}le" (like fem)

Missing tag error tests:
- greek_o_missing_gender_tag: no gender tag -> MissingTag error
- romanian_def_missing_gender_tag: no gender tag -> MissingTag error

Integration tests using Locale:
- greek_article_in_phrase: Test with full phrase evaluation
- romanian_postposed_article_in_phrase: Test suffix appending in context

Run: cargo test --package rlf -- greek
Run: cargo test --package rlf -- romanian
  </action>
  <verify>cargo test --package rlf -- --test-threads=1 2>&1 | tail -20</verify>
  <done>All Greek and Romanian transform tests pass</done>
</task>

</tasks>

<verification>
- cargo check --package rlf passes
- cargo test --package rlf -- greek passes all Greek tests
- cargo test --package rlf -- romanian passes all Romanian tests
- cargo clippy --package rlf passes
- cargo fmt --check passes
</verification>

<success_criteria>
- Greek @o/@i/@to produces correct definite article by gender, case, and number
- Greek @enas/@mia/@ena produces correct indefinite article by gender and case
- Romanian @def appends correct article suffix based on gender and number
- Romanian neuter singular uses masculine suffix, neuter plural uses feminine suffix
- All 25+ new tests pass
- No regressions in existing transform tests
</success_criteria>

<output>
After completion, create `.planning/phases/08-greek-romanian-and-middle-eastern-transforms/08-01-SUMMARY.md`
</output>
